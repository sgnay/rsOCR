import { VerticalBox, HorizontalBox, Button, TextEdit } from "std-widgets.slint";

export component rsOCR inherits Window {
    title: "rsOCR - 图片文字识别工具";
    default-font-family: "Microsoft YaHei";
    width: 1000px;
    height: 700px;
    background: #f5f5f5;
    
    // 状态变量
    in property<string> selected-image-path: "";
    in property<image> selected-image: @image-url("");
    in property<string> ocr-result: "";
    in property<bool> processing: false;
    in property<string> status-message: "就绪";
    in-out property<string> api-url: "http://127.0.0.1:1224/api/ocr";
    
    // 函数定义
    callback select-image();
    callback perform-ocr();
    callback copy-to-clipboard();
    
    VerticalBox {
        spacing: 10px;
        padding: 10px;
        
        // 状态栏
        HorizontalBox {
            height: 30px;
            Text {
                text: "状态: " + status-message;
                color: #333;
                font-size: 14px;
            }
        }
        
        // 主内容区域
        HorizontalBox {
            spacing: 15px;
            
            // 左侧图片区域
            VerticalBox {
                width: 50%;
                spacing: 10px;
                
                Text {
                    text: "图片预览";
                    font-size: 16px;
                    color: #2c3e50;
                }
                
                Rectangle {
                    background: white;
                    border-radius: 5px;
                    border-width: 1px;
                    border-color: #ddd;
                    
                    VerticalBox {
                        alignment: center;
                        spacing: 10px;
                        
                        // 图片预览区域
                        Rectangle {
                            width: 100%;
                            height: 100%;
                            background: #f0f0f0;
                            
                            Text {
                                text: "请选择图片";
                                color: #999;
                                font-size: 14px;
                                horizontal-alignment: center;
                                visible: selected-image-path == "";
                            }
                            
                            Image {
                                width: 100%;
                                height: 100%;
                                source: selected-image;
                                visible: selected-image-path != "";
                            }
                        }
                    }
                }
                
                HorizontalBox {
                    spacing: 5px;
                    Text {
                        text: "图片路径:";
                        color: #666;
                        font-size: 12px;
                    }
                    Text {
                        text: selected-image-path == "" ? "未选择" : selected-image-path;
                        color: #333;
                        font-size: 12px;
                        horizontal-alignment: left;
                    }
                }
                
                Button {
                    text: "选择图片";
                    clicked => {
                        select-image();
                    }
                }
            }
            
            // 右侧OCR结果区域
            VerticalBox {
                width: 50%;
                spacing: 10px;
                
                Text {
                    text: "OCR识别结果";
                    font-size: 16px;
                    color: #2c3e50;
                }
                
                Rectangle {
                    background: white;
                    border-radius: 5px;
                    border-width: 1px;
                    border-color: #ddd;
                    
                    TextEdit {
                        width: 100%;
                        height: 100%;
                        text: ocr-result;
                        wrap: word-wrap;
                        font-size: 14px;
                    }
                }
                
                HorizontalBox {
                    spacing: 10px;
                    
                    Button {
                        text: "执行OCR";
                        clicked => {
                            perform-ocr();
                        }
                    }
                    
                    Button {
                        text: "复制结果";
                        clicked => {
                            copy-to-clipboard();
                        }
                    }
                }
            }
        }
        
        // 底部控制区域
        HorizontalBox {
            spacing: 10px;
            alignment: center;
            
            HorizontalBox {
                spacing: 5px;
                Text {
                    text: "API URL:";
                    color: #666;
                    font-size: 12px;
                }
                TextEdit {
                    width: 300px;
                    text: api-url;
                    font-size: 12px;
                    enabled: true;
                }
            }
        }
    }
}
